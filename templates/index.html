<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ajuste de curvas</title>
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <div class="container">
        <h1>Ajuste de curvas</h1>

        <form action="/" method="POST" enctype="multipart/form-data">
            <label for="titulo">Título:</label>
            <input type="text" name="titulo" id="titulo" required>

            <label for="nombre_x">Nombre del eje X:</label>
            <input type="text" name="nombre_x" id="nombre_x" required>

            <label for="nombre_y">Nombre del eje Y:</label>
            <input type="text" name="nombre_y" id="nombre_y" required>

            <div class="radio-group">
                <label>Fuente de datos:</label>
                <input type="radio" name="metodo" value="manual" id="manual" checked>
                <label for="manual" class="inline-label">Ingresar manualmente</label>
                <br>
                <input type="radio" name="metodo" value="archivo" id="archivo_radio">
                <label for="archivo_radio" class="inline-label">Subir archivo</label>
            </div>

            <label for="valores_x">Valores X (separados por comas):</label>
            <input type="text" name="valores_x" id="valores_x">

            <label for="valores_y">Valores Y (separados por comas):</label>
            <input type="text" name="valores_y" id="valores_y">

            <label for="archivo">Archivo (.txt o .docx con X en línea 1 y Y en línea 2):</label>
            <input type="file" name="archivo" id="archivo">

            <label for="grado">Grado del polinomio:</label>
            <select name="grado" id="grado">
                <option value="auto">Automático</option>
                <option value="1">1 (Recta)</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>

            <button type="submit">Graficar</button>
        </form>

        <form action="/" method="POST">
            <input type="hidden" name="accion" value="unificar">
            <button type="submit" class="secondary-button">Unificar gráficas existentes</button>
        </form>

        {% if mensaje %}
            <p class="mensaje">{{ mensaje }}</p>
        {% endif %}

        {% if imagen %}
            <img src="{{ imagen }}" alt="Gráfica">
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const radios = document.querySelectorAll('input[name="metodo"]');
            const inputArchivo = document.getElementById('archivo');
            const inputValoresX = document.getElementById('valores_x');
            const inputValoresY = document.getElementById('valores_y');

            function actualizarCampos() {
                const metodo = document.querySelector('input[name="metodo"]:checked').value;
                if (metodo === 'archivo') {
                    inputArchivo.disabled = false;
                    inputValoresX.disabled = true;
                    inputValoresY.disabled = true;
                } else {
                    inputArchivo.disabled = true;
                    inputValoresX.disabled = false;
                    inputValoresY.disabled = false;
                }
            }

            radios.forEach(radio => {
                radio.addEventListener('change', actualizarCampos);
            });

            actualizarCampos();
        });

        document.querySelector('form[action="/"][method="POST"]').addEventListener('submit', function(event) {
            const metodo = document.querySelector('input[name="metodo"]:checked').value;
            const valoresX = document.getElementById('valores_x').value.trim();
            const valoresY = document.getElementById('valores_y').value.trim();
            const archivo = document.getElementById('archivo').files;

            if (metodo === 'manual') {
                if (!valoresX || !valoresY) {
                    alert('Por favor, ingresa los valores X e Y separados por comas.');
                    event.preventDefault();
                    return;
                }

                const arrX = valoresX.split(',').map(x => x.trim());
                const arrY = valoresY.split(',').map(y => y.trim());

                if (arrX.length !== arrY.length) {
                    alert('Los valores X e Y deben tener la misma cantidad de elementos.');
                    event.preventDefault();
                    return;
                }

                if (arrX.some(x => isNaN(Number(x))) || arrY.some(y => isNaN(Number(y)))) {
                    alert('Todos los valores X e Y deben ser números válidos.');
                    event.preventDefault();
                    return;
                }
            } else {
                if (archivo.length === 0) {
                    alert('Por favor, selecciona un archivo para subir.');
                    event.preventDefault();
                    return;
                }
                const nombreArchivo = archivo[0].name.toLowerCase();
                if (!nombreArchivo.endsWith('.txt') && !nombreArchivo.endsWith('.docx')) {
                    alert('El archivo debe ser .txt o .docx');
                    event.preventDefault();
                    return;
                }
            }
        });
    </script>
</body>
</html>
