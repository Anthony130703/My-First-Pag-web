<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ajuste de curvas</title>
</head>
<body>
    <h1>Ajuste de curvas</h1>

    <form action="/" method="POST" enctype="multipart/form-data">
        <label>Título:</label>
        <input type="text" name="titulo" required><br>

        <label>Nombre del eje X:</label>
        <input type="text" name="nombre_x" required><br>

        <label>Nombre del eje Y:</label>
        <input type="text" name="nombre_y" required><br>

        <label>Fuente de datos:</label><br>
        <input type="radio" name="metodo" value="manual" checked> Ingresar manualmente<br>
        <input type="radio" name="metodo" value="archivo"> Subir archivo<br><br>

        <label>Valores X (separados por comas):</label><br>
        <input type="text" name="valores_x"><br>

        <label>Valores Y (separados por comas):</label><br>
        <input type="text" name="valores_y"><br>

        <label>Archivo (.txt o .docx con X en línea 1 y Y en línea 2):</label>
        <input type="file" name="archivo"><br>

        <label>Grado del polinomio:</label>
        <select name="grado">
            <option value="auto">Automático</option>
            <option value="1">1 (Recta)</option>
            <option value="2">2</option>
            <option value="3">3</option>
        </select><br><br>

        <button type="submit">Graficar</button>
    </form>

    <form action="/" method="POST">
        <input type="hidden" name="accion" value="unificar">
        <button type="submit">Unificar gráficas existentes</button>
    </form>

    {% if mensaje %}
        <p style="color: red;">{{ mensaje }}</p>
    {% endif %}

    {% if imagen %}
        <img src="{{ imagen }}" style="max-width: 80%; margin-top: 20px;">
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const radios = document.querySelectorAll('input[name="metodo"]');
            const inputArchivo = document.querySelector('input[name="archivo"]');
            const inputValoresX = document.querySelector('input[name="valores_x"]');
            const inputValoresY = document.querySelector('input[name="valores_y"]');

            function actualizarCampos() {
                const metodo = document.querySelector('input[name="metodo"]:checked').value;
                if (metodo === 'archivo') {
                    inputArchivo.disabled = false;
                    inputValoresX.disabled = true;
                    inputValoresY.disabled = true;
                } else {
                    inputArchivo.disabled = true;
                    inputValoresX.disabled = false;
                    inputValoresY.disabled = false;
                }
            }

            radios.forEach(radio => {
                radio.addEventListener('change', actualizarCampos);
            });

            actualizarCampos();
        });

        document.querySelector('form[action="/"][method="POST"]').addEventListener('submit', function(event) {
            const metodo = document.querySelector('input[name="metodo"]:checked').value;
            const valoresX = document.querySelector('input[name="valores_x"]').value.trim();
            const valoresY = document.querySelector('input[name="valores_y"]').value.trim();
            const archivo = document.querySelector('input[name="archivo"]').files;

            if (metodo === 'manual') {
                if (!valoresX || !valoresY) {
                    alert('Por favor, ingresa los valores X e Y separados por comas.');
                    event.preventDefault();
                    return;
                }

                const arrX = valoresX.split(',').map(x => x.trim());
                const arrY = valoresY.split(',').map(y => y.trim());

                if (arrX.length !== arrY.length) {
                    alert('Los valores X e Y deben tener la misma cantidad de elementos.');
                    event.preventDefault();
                    return;
                }

                if (arrX.some(x => isNaN(Number(x))) || arrY.some(y => isNaN(Number(y)))) {
                    alert('Todos los valores X e Y deben ser números válidos.');
                    event.preventDefault();
                    return;
                }
            } else {
                if (archivo.length === 0) {
                    alert('Por favor, selecciona un archivo para subir.');
                    event.preventDefault();
                    return;
                }
                const nombreArchivo = archivo[0].name.toLowerCase();
                if (!nombreArchivo.endsWith('.txt') && !nombreArchivo.endsWith('.docx')) {
                    alert('El archivo debe ser .txt o .docx');
                    event.preventDefault();
                    return;
                }
            }
        });
    </script>
</body>
</html>
